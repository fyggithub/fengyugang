#include "common_init.h"
#include "process.h"
#include "delay.h"
#include "sys.h"
#include "gpio.h"
#include "debug_usart.h"
#include "wdg.h"
#include "lm75.h"
#include "ds1339c.h"
#include "ir.h"
#include "tmds181.h"
#include "fan.h"
#include "led.h"
#include "timer.h"
#include "oled.h"
#include "stm32f10x_i2c.h"
#include "myiic.h"
#include "usart.h"

extern unsigned int s_numOf100us;
static void sys_update()
{	
	//ir_check_get_data();        /* 红外 */
	lm75_check_read_temp();     /* 温度 */
	update_led();                  
	oled_update_display();   
	update_fan_speed();    

	ds1339c_check_write_rtc();  /* 时钟 */
	ds1339c_check_read_rtc();	
	
    hds3ss215_check_switch();	/* 视频掉电环回 */
    pwr_control();	
    //button_press_release();   // 中断方式，物理按键开关机
    detect_power_pin();         // detect power on/off by polling 
    clean_uart_buf();
    ir_decode_data();           /* cpu断电后，红外开机 */
    tmds181_register_ctl();     /* this is for test */
    
    it6662_register_ctl(); /* for test */
    
}

// while 循环，一次200us
int main(void)  
{
	sys_init();		
	cpu_power_init();
    delay_ms(100);
    hds3ss215_switch_rk3339();
    printf("enter app\n");

    while(1)
	{			   
		hostBoardProc();
		sys_update();
        IT6662_Main();
	}
}

#include "delay.h"
#include "lcd.h"
#include "debug_usart.h"
#include <string.h>

#define CS_1             GPIO_SetBits(GPIOD, GPIO_Pin_3)    //取消LCD片选
#define CS_0             GPIO_ResetBits(GPIOD, GPIO_Pin_3)  //LCD片选有效
#define RST_1            GPIO_SetBits(GPIOD, GPIO_Pin_4)    //LCD低电平复位，复位之后保持高电平
#define RST_0            GPIO_ResetBits(GPIOD, GPIO_Pin_4)  //LCD复位
#define A0_1             GPIO_SetBits(GPIOD, GPIO_Pin_5)    //Ao=1,向LCD输入数据
#define A0_0             GPIO_ResetBits(GPIOD, GPIO_Pin_5)  //Ao=0,向LCD写入指令
#define SCLK_1           GPIO_SetBits(GPIOD, GPIO_Pin_6)    //串行时钟信号高
#define SCLK_0           GPIO_ResetBits(GPIOD, GPIO_Pin_6)  //串行时钟信号低
#define DATA_1           GPIO_SetBits(GPIOD, GPIO_Pin_7)    //串行数据信号高
#define DATA_0           GPIO_ResetBits(GPIOD, GPIO_Pin_7)  //串行数据信号低 
	
unsigned char ip_tab[][16] = 
{
	{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x00,0x00,0x00,0x00,0x00},	// .
	{0x00,0xF8,0x04,0x04,0x04,0xF8,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x03,0x00,0x00},	// 0
	{0x00,0x00,0x08,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x07,0x04,0x00,0x00,0x00},	// 1
	{0x00,0x18,0x04,0x84,0x44,0x38,0x00,0x00,0x00,0x06,0x05,0x04,0x04,0x04,0x00,0x00},	// 2
	{0x00,0x08,0x04,0x24,0x24,0xD8,0x00,0x00,0x00,0x02,0x04,0x04,0x04,0x03,0x00,0x00},	// 3
	{0x80,0x60,0x10,0x08,0xFC,0x00,0x00,0x00,0x00,0x01,0x01,0x05,0x07,0x04,0x00,0x00},	// 4
	{0x00,0x7C,0x24,0x24,0x24,0xC4,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x03,0x00,0x00},	// 5
	{0x00,0xF0,0x48,0x24,0x24,0xCC,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x03,0x00,0x00},	// 6
	{0x00,0x0C,0x04,0xC4,0x3C,0x04,0x00,0x00,0x00,0x00,0x00,0x07,0x00,0x00,0x00,0x00},	// 7
	{0x00,0x98,0x64,0x44,0x64,0x98,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x03,0x00,0x00},	// 8
	{0x00,0x78,0x84,0x84,0x44,0xF8,0x00,0x00,0x00,0x06,0x04,0x04,0x02,0x01,0x00,0x00},	// 9
};

unsigned char main_slave_tab[][32] = 
{
	{0x00,0x00,0x88,0x88,0x88,0x89,0xFA,0x88,0x88,0x88,0x88,0x00,0x00,0x00,0x00,0x00,	// 主
	0x00,0x08,0x08,0x08,0x08,0x08,0x0F,0x08,0x08,0x08,0x08,0x08,0x00,0x00,0x00,0x00},
	{0x00,0x20,0x24,0xD2,0x57,0x4A,0xCA,0x4A,0x56,0xD2,0x20,0x20,0x00,0x00,0x00,0x00,	// 备
	0x00,0x00,0x00,0x0F,0x05,0x05,0x07,0x05,0x05,0x0F,0x00,0x00,0x00,0x00,0x00,0x00},
	{0x00,0x00,0xFE,0x92,0x92,0x92,0xFE,0x92,0x92,0x92,0xFE,0x00,0x00,0x00,0x00,0x00,	// 用
	0x00,0x08,0x07,0x00,0x00,0x00,0x07,0x00,0x08,0x08,0x0F,0x00,0x00,0x00,0x00,0x00},
};

unsigned char string_tab[][16] = 
{
	{0x00,0x00,0xF0,0x8C,0xF0,0x00,0x00,0x00,0x04,0x07,0x04,0x00,0x04,0x07,0x04,0x00},	// (0)A
	{0x04,0xFC,0x24,0x24,0x24,0xD8,0x00,0x00,0x04,0x07,0x04,0x04,0x04,0x03,0x00,0x00},	// (1)B
	{0xF0,0x08,0x04,0x04,0x04,0x0C,0x00,0x00,0x01,0x02,0x04,0x04,0x04,0x02,0x00,0x00},	// (2)C
	{0x04,0xFC,0x04,0x04,0x08,0xF0,0x00,0x00,0x04,0x07,0x04,0x04,0x02,0x01,0x00,0x00},	// (3)D
	{0x04,0xFC,0x44,0x44,0xE4,0x0C,0x00,0x00,0x04,0x07,0x04,0x04,0x04,0x06,0x00,0x00},	// E
	{0x04,0xFC,0x44,0x44,0xE4,0x0C,0x00,0x00,0x04,0x07,0x04,0x00,0x00,0x00,0x00,0x00},	// F
	{0xF0,0x08,0x04,0x84,0x8C,0x80,0x00,0x00,0x01,0x02,0x04,0x04,0x03,0x00,0x00,0x00},	// G
	{0x04,0xFC,0x44,0x40,0x44,0xFC,0x04,0x00,0x04,0x07,0x04,0x00,0x04,0x07,0x04,0x00},	// H
	{0x00,0x04,0x04,0xFC,0x04,0x04,0x00,0x00,0x00,0x04,0x04,0x07,0x04,0x04,0x00,0x00},	// I
	{0x00,0x04,0x04,0xFC,0x04,0x04,0x00,0x00,0x0C,0x08,0x08,0x07,0x00,0x00,0x00,0x00},	// J
	{0x04,0xFC,0x64,0xD0,0x0C,0x04,0x00,0x00,0x04,0x07,0x04,0x00,0x07,0x04,0x00,0x00},	// K
	{0x04,0xFC,0x04,0x00,0x00,0x00,0x00,0x00,0x04,0x07,0x04,0x04,0x04,0x06,0x00,0x00},	// L
	{0x04,0xFC,0x3C,0xC0,0x3C,0xFC,0x04,0x00,0x04,0x07,0x00,0x07,0x00,0x07,0x04,0x00},	// M
	{0x04,0xFC,0x1C,0xE0,0x04,0xFC,0x04,0x00,0x04,0x07,0x04,0x00,0x03,0x07,0x00,0x00},	// N
	{0xF0,0x08,0x04,0x04,0x08,0xF0,0x00,0x00,0x01,0x02,0x04,0x04,0x02,0x01,0x00,0x00},	// O
	{0x04,0xFC,0x44,0x44,0x44,0x38,0x00,0x00,0x04,0x07,0x04,0x00,0x00,0x00,0x00,0x00},	// P
	{0xF0,0x08,0x04,0x04,0x08,0xF0,0x00,0x00,0x01,0x02,0x05,0x05,0x0E,0x09,0x00,0x00},	// Q
	{0x04,0xFC,0x24,0x64,0xA4,0x18,0x00,0x00,0x04,0x07,0x04,0x00,0x01,0x06,0x04,0x00},	// R
	{0x00,0x18,0x24,0x44,0x44,0x8C,0x00,0x00,0x00,0x06,0x04,0x04,0x04,0x03,0x00,0x00},	// S
	{0x00,0x0C,0x04,0xFC,0x04,0x0C,0x00,0x00,0x00,0x00,0x04,0x07,0x04,0x00,0x00,0x00},	// T
	{0x04,0xFC,0x04,0x00,0x04,0xFC,0x04,0x00,0x00,0x03,0x04,0x04,0x04,0x03,0x00,0x00},	// U
	{0x04,0x1C,0xE4,0x00,0xE4,0x1C,0x04,0x00,0x00,0x00,0x01,0x06,0x01,0x00,0x00,0x00},	// V
	{0x04,0xFC,0x80,0x7C,0x80,0xFC,0x04,0x00,0x00,0x00,0x07,0x00,0x07,0x00,0x00,0x00},	// W
	{0x04,0x1C,0xE0,0xE4,0x1C,0x04,0x00,0x00,0x04,0x07,0x04,0x00,0x07,0x04,0x00,0x00},	// X
	{0x04,0x0C,0x34,0xC0,0x34,0x0C,0x04,0x00,0x00,0x00,0x04,0x07,0x04,0x00,0x00,0x00},	// Y
	{0x00,0x0C,0x04,0xE4,0x1C,0x04,0x00,0x00,0x00,0x04,0x07,0x04,0x04,0x06,0x00,0x00},	// Z

	{0x00,0x40,0x20,0xA0,0xA0,0xC0,0x00,0x00,0x00,0x02,0x05,0x04,0x04,0x07,0x04,0x00},	// (26)a
	{0x04,0xFC,0x20,0x20,0x20,0xC0,0x00,0x00,0x00,0x07,0x04,0x04,0x04,0x03,0x00,0x00},	// b
	{0x00,0xC0,0x20,0x20,0x20,0x60,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x02,0x00,0x00},	// c
	{0x00,0xC0,0x20,0x20,0x24,0xFC,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x07,0x04,0x00},	// d
	{0x00,0xC0,0xA0,0xA0,0xA0,0xC0,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x02,0x00,0x00},	// e
	{0x20,0x20,0xF8,0x24,0x24,0x0C,0x00,0x00,0x00,0x04,0x07,0x04,0x04,0x00,0x00,0x00},	// f
	{0x00,0xC0,0x20,0x20,0xE0,0x20,0x00,0x00,0x00,0x0E,0x15,0x15,0x14,0x08,0x00,0x00},	// g
	{0x04,0xFC,0x40,0x20,0x20,0xC0,0x00,0x00,0x04,0x07,0x04,0x00,0x00,0x07,0x04,0x00},	// h
	{0x00,0x20,0x20,0xE4,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x07,0x04,0x04,0x00,0x00},	// i
	{0x00,0x00,0x20,0x20,0xE4,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x0F,0x00,0x00,0x00},	// j
	{0x04,0xFC,0x00,0xA0,0x60,0x20,0x00,0x00,0x04,0x07,0x05,0x01,0x06,0x04,0x00,0x00},	// k
	{0x00,0x04,0x04,0xFC,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x07,0x04,0x04,0x00,0x00},	// l
	{0x20,0xE0,0x20,0xE0,0x20,0xC0,0x00,0x00,0x04,0x07,0x00,0x07,0x00,0x07,0x04,0x00},	// m
	{0x20,0xE0,0x40,0x20,0x20,0xC0,0x00,0x00,0x04,0x07,0x04,0x00,0x00,0x07,0x04,0x00},	// n
	{0x00,0xC0,0x20,0x20,0x20,0xC0,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x03,0x00,0x00},	// o
	{0x20,0xE0,0x20,0x20,0x20,0xC0,0x00,0x00,0x10,0x1F,0x14,0x04,0x04,0x03,0x00,0x00},	// p
	{0x00,0xC0,0x20,0x20,0x20,0xE0,0x00,0x00,0x00,0x03,0x04,0x04,0x14,0x1F,0x10,0x00},	// q
	{0x00,0x20,0xE0,0x40,0x20,0x20,0x00,0x00,0x00,0x04,0x07,0x04,0x04,0x00,0x00,0x00},	// r
	{0x00,0x40,0xA0,0xA0,0x20,0x60,0x00,0x00,0x00,0x06,0x04,0x04,0x05,0x02,0x00,0x00}, 	// s
	{0x20,0x20,0xF8,0x20,0x20,0x00,0x00,0x00,0x00,0x00,0x03,0x04,0x04,0x00,0x00,0x00},	// t
	{0x20,0xE0,0x00,0x00,0x20,0xE0,0x00,0x00,0x00,0x03,0x04,0x04,0x04,0x07,0x04,0x00},	// u
	{0x20,0xE0,0x20,0x00,0x20,0xE0,0x20,0x00,0x00,0x00,0x03,0x04,0x03,0x00,0x00,0x00},	// v
	{0x20,0xE0,0x00,0xE0,0x00,0xE0,0x20,0x00,0x00,0x01,0x06,0x01,0x06,0x01,0x00,0x00},	// w
	{0x20,0x60,0x80,0xA0,0x60,0x20,0x00,0x00,0x04,0x06,0x05,0x01,0x06,0x04,0x00,0x00},	// x
	{0x20,0x60,0xA0,0x00,0xA0,0x60,0x20,0x00,0x10,0x10,0x19,0x06,0x01,0x00,0x00,0x00},	// y
	{0x00,0x60,0x20,0xA0,0x60,0x20,0x00,0x00,0x00,0x04,0x06,0x05,0x04,0x06,0x00,0x00},	// z	
};

static void lcd_GPIO_Configuration(void)
{
    GPIO_InitTypeDef GPIO_InitStructure;
  
    GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2 | GPIO_Pin_3 | GPIO_Pin_4 | GPIO_Pin_5 | GPIO_Pin_6 | GPIO_Pin_7;
    GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;
    GPIO_Init(GPIOD, &GPIO_InitStructure);
}

/* 串行模式发送数据 */
static void lcd_sendByte(unsigned char data)
{
	unsigned char value;
	unsigned char temp;
	int i;

	SCLK_0;
	value = data;

	for(i = 8; i > 0; i--)
	{
		SCLK_0;
        delay_us(2);
		temp = value & 0x80;
		if(temp)
		{
            DATA_1;
        }
		else
        {
            DATA_0;
        }

		//delay_us(1);
        SCLK_1;
		//delay_us(1);
		value = value << 1;
	}
}

/* 写命令,串行模式 */
static void lcd_sendCmd(unsigned char cmd)
{
    A0_0;
    CS_0;
    lcd_sendByte(cmd);
}

/* 写数据，串行模式*/
static void lcd_sendData(unsigned char data) 
{
    A0_1;
    CS_0;
    lcd_sendByte(data);
}

void lcd_BackLightOn(void)
{
    GPIO_SetBits(GPIOD, GPIO_Pin_2);
}

void lcd_BackLightOff(void)
{
    GPIO_ResetBits(GPIOD, GPIO_Pin_2);
}

void lcd_reset(void)
{
	RST_0;
    /* min 1us */
    delay_us(2);
	RST_1;
}

void lcd_On(void)
{
    lcd_sendCmd(0xaf);        
}

void lcd_Off(void)
{
	lcd_sendCmd(0xae);
}

void lcd_clearScreen(void)
{
	unsigned char seg;
	unsigned char page;

	for(page = 0xb0; page < 0xb4; page++) 
	{
		lcd_sendCmd(page);
		lcd_sendCmd(0x10); //列地址,高低字节两次写入,从第0 列开始
		lcd_sendCmd(0x00);
		//lcd_sendCmd(0x40); //从第0行开始
		for(seg = 0; seg < 128; seg++) //写128 列
		{ 
            lcd_sendData(0x00); 
        }

	}
}
#if 0
static void lcd_display(unsigned char *p)
{
	unsigned char seg;
	unsigned char page;

	for(page = 0xb0; page < 0xb4; page++) //写页地址共8 页0xb0----0xb8
	{
		lcd_sendCmd(page);
		lcd_sendCmd(0x10); //列地址,高低字节两次写入,从第0 列开始
		lcd_sendCmd(0x00);
		for(seg = 0; seg < 128; seg++) //写128 列
		{ 
            lcd_sendData(*p++); 
        }
	}
}
#endif

void lcd_display_8x8(u8 num, unsigned char *p)
{
	u8 i, j;
	if(num <= 16) 
	{
		lcd_sendCmd(0xb0);
		lcd_sendCmd(0x10);	//列地址，从第0列开始
		lcd_sendCmd(0x40);	//行地址，从第0行开始
		for(i = 0; i < num; i++)
		{
			for(j = 0; j < 8; j++)
			{
				lcd_sendData(p[8*i+j]);
			}
		}		
	}
}

/* 可以显示两行字体  
 * 16*16点阵的字体
 * StartPage: 0--3, 一共4页
 * column: 0--127
 * num表示显示字符个数，最大为16;
 */
void lcd_display_16x16(u8 StartPage, u8 column, u8 num, unsigned char *p)
{
	u8 i, j;
	u8 msb, lsb;

	msb = column / 16;
	lsb = column % 16;
	
	if(num <= 8)
	{
		lcd_sendCmd(0xb0 + StartPage);
		lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
		lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
		lcd_sendCmd(0x40);				//行地址，从第0行开始
		for(i = 0; i < num; i++)
		{
			for(j = 0; j < 16; j++)
			{
				if((16*2*i+j) < 32*num)
				{ 
					lcd_sendData(p[16*2*i+j]);
				}
			}
		}

		lcd_sendCmd(0xb1 + StartPage);
		lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
		lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
		lcd_sendCmd(0x40);				//行地址，从第0行开始
		for(i = 0; i < num; i++)
		{
			for(j=0;j<16;j++)
			{
				if((16*(2*i+1)+j) < 32*num)
				{ 
					lcd_sendData(p[16*(2*i+1)+j]);
				}
			}
		}
	}
	else if(num > 8)
	{
		lcd_sendCmd(0xb0 + StartPage);
		lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
		lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
		lcd_sendCmd(0x40);				//行地址，从第0行开始
		for(i = 0; i < 8; i++)
		{
			for(j = 0; j < 16; j++)
			{
				if(16*2*i+j<32*num)
				{
					lcd_sendData(p[16*2*i+j]);
				}
			}
		}

		lcd_sendCmd(0xb1 + StartPage);
		lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
		lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
		lcd_sendCmd(0x40);				//行地址，从第0行开始
		for(i = 0; i < 8; i++)
		{
			for(j = 0; j < 16; j++)
			{
				if((16*(2*i+1)+j) < 32*num)
				{
					lcd_sendData(p[16*(2*i+1)+j]);
				}
			}
		}

		lcd_sendCmd(0xb2);
		lcd_sendCmd(0x10);	//列地址，从第0列开始
		lcd_sendCmd(0x40);	//行地址，从第0行开始
		for(i = 8; i < num; i++)
		{
			for(j = 0; j < 16; j++)
			{
				if((16*2*i+j) < 32*num)
				{
					lcd_sendData(p[16*2*i+j]);
				}
			}
		}

		lcd_sendCmd(0xb3);
		lcd_sendCmd(0x10);	//列地址，从第0列开始
		lcd_sendCmd(0x40);	//行地址，从第0行开始
		for(i = 8; i < num; i++)
		{
			for(j = 0; j < 16; j++)
			{
				if((16*(2*i+1)+j) < 32*num)
				{
					lcd_sendData(p[16*(2*i+1)+j]);
				}
			}
		}
	}	
}

/* 只显示一行; 显示两行，需要调用两次此接口
 * 16*16点阵的字体
 * StartPage: 0--3, 一共4页
 * column: 0--127
 * num表示显示字符个数，最大为16;
 */
void lcd_display_16x16_line(u8 StartPage, u8 column, u8 num, unsigned char *src)
{
	u8 i,j;
	u8 msb, lsb;

	msb = column / 16;
	lsb = column % 16;
	lcd_sendCmd(0xb0 + StartPage);
	lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
	lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
	lcd_sendCmd(0x40);				//行地址，从第0行开始
	
	for(i = 0; i < num; i++)
	{ 
		for(j = 0; j < 16; j++)
		{
			lcd_sendData(src[16*2*i+j]);
		}
	}
	
	lcd_sendCmd(0xb1 + StartPage);
	lcd_sendCmd(0x10 + msb);		//列地址，高位MSB
	lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
	lcd_sendCmd(0x40);				//行地址，从第0行开始
	for(i = 0; i < num; i++)
	{
		for(j = 0; j < 16; j++)
		{
			lcd_sendData(src[16*(2*i+1)+j]);
		}
	}

}

/* 可以显示两行字体
 * 8*16点阵的字体
 * StartPage: 0--3, 一共4页
 * column: 0--127
 * num表示显示字符个数，最大为32;
 */
void lcd_display_8x16(u8 StartPage, u8 column, u8 num, unsigned char *p)
{
	u8 i, j;
	u8 msb, lsb;

	msb = column / 16;
	lsb = column % 16;
	
	if(num <= 16)
	{
		lcd_sendCmd(0xb0 + StartPage);
		lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
		lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
		lcd_sendCmd(0x40);				//行地址，从第0行开始
		for(i = 0; i < num; i++)
		{
			for(j = 0; j < 8; j++)
			{
				if((8*2*i+j) < 16*num)
				{ 
					lcd_sendData(p[8*2*i+j]);
				}
			}
		}

		lcd_sendCmd(0xb1 + StartPage);
		lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
		lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
		lcd_sendCmd(0x40);				//行地址，从第0行开始
		for(i = 0; i < num; i++)
		{
			for(j = 0; j < 8; j++)
			{
				if((8*(2*i+1)+j) < 16*num)
				{ 
					lcd_sendData(p[8*(2*i+1)+j]);
				}
			}
		}
	}
	else if(num > 16)
	{
		lcd_sendCmd(0xb0 + StartPage);
		lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
		lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
		lcd_sendCmd(0x40);				//行地址，从第0行开始
		for(i = 0; i < 16; i++)
		{
			for(j = 0; j < 8; j++)
			{
				if(8*2*i+j < 16*num)
				{
					lcd_sendData(p[8*2*i+j]);
				}
			}
		}

		lcd_sendCmd(0xb1 + StartPage);
		lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
		lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
		lcd_sendCmd(0x40);				//行地址，从第0行开始
		for(i = 0; i < 16; i++)
		{
			for(j = 0; j < 8; j++)
			{
				if((8*(2*i+1)+j) < 16*num)
				{
					lcd_sendData(p[8*(2*i+1)+j]);
				}
			}
		}

		lcd_sendCmd(0xb2);
		lcd_sendCmd(0x10);	//列地址，从第0列开始
		lcd_sendCmd(0x40);	//行地址，从第0行开始
		for(i = 16; i < num; i++)
		{
			for(j = 0; j < 8; j++)
			{
				if((8*2*i+j) < 16*num)
				{
					lcd_sendData(p[8*2*i+j]);
				}
			}
		}

		lcd_sendCmd(0xb3);
		lcd_sendCmd(0x10);	//列地址，从第0列开始
		lcd_sendCmd(0x40);	//行地址，从第0行开始
		for(i = 16; i < num; i++)
		{
			for(j = 0; j < 8; j++)
			{
				if((8*(2*i+1)+j) < 16*num)
				{
					lcd_sendData(p[8*(2*i+1)+j]);
				}
			}
		}
	}	
}

/* 只显示一行，显示两行，需要调用两次此接口
 * StartPage: 0--3
 * column: 0--127, 
 * num: 字符个数0--32
 */
void lcd_display_8x16_lines(u8 StartPage, u8 column, u8 num, unsigned char *src)

{
	u8 i,j;
	unsigned char msb, lsb;

	msb = column / 16;
	lsb = column % 16;
	lcd_sendCmd(0xb0 + StartPage);
	lcd_sendCmd(0x10 + msb);		//列地址，高位MSB 
	lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
	lcd_sendCmd(0x40);				//行地址，从第0行开始
	
	for(i = 0; i < num; i++)
	{ 
		for(j = 0; j < 8; j++)
		{
			lcd_sendData(src[8*2*i+j]);
		}
	}
	
	lcd_sendCmd(0xb1 + StartPage);
	lcd_sendCmd(0x10 + msb);		//列地址，高位MSB
	lcd_sendCmd(0x00 + lsb);		//列地址，低位LSB
	lcd_sendCmd(0x40);				//行地址，从第0行开始
	for(i = 0; i < num; i++)
	{
		for(j = 0; j < 8; j++)
		{
			lcd_sendData(src[8*(2*i+1)+j]);
		}
	}
}

/* StartPage: 0--3; column: 0--127 */
void lcd_display_ip(char *ip_address, u8 StartPage, u8 column)
{
	char *Src_Pointer;
	int ret = -1;
	u8 num = 0;
	
	Src_Pointer = ip_address;
	num = strlen(Src_Pointer);
	column = (128 - num*8) / 2;

	while(num--) 
	{
		if(*Src_Pointer == 0x20) 
		{
			column += 8;
			Src_Pointer++;
			continue;
		}

		ret = strncmp(Src_Pointer, ".", 1);
		if(ret == 0) 
		{
			lcd_display_8x16(StartPage, column, 1, &ip_tab[0][0]);
			column += 8;
		} 
		else {
			lcd_display_8x16(StartPage, column, 1, &ip_tab[(*Src_Pointer-'0') + 1][0]);
			column += 8;
		}

		Src_Pointer++;
		if(0 == *Src_Pointer)
		{
			return;
		}
	}
}

/* StartPage: 0--3; column: 0--127 */
void lcd_display_mainSlave(char *src, u8 StartPage, u8 column)
{		
	if (0 == strncmp(src, "main", 4))
	{
		lcd_display_16x16(0, column, 1, &main_slave_tab[0][0]);
		lcd_display_16x16(0, (column+16), 1, &main_slave_tab[2][0]);
		
	}
	else if (0 == strncmp(src, "slave", 5))
	{
		lcd_display_16x16(0, column, 1, &main_slave_tab[1][0]);
		lcd_display_16x16(0, (column+16), 1, &main_slave_tab[2][0]);
	}

	return;
}

void lcd_init(void)
{
  	lcd_GPIO_Configuration();

	lcd_reset();
	lcd_BackLightOn();
	
	lcd_sendCmd(0xaf); //ON DISPLAY
	lcd_sendCmd(0x40); //STAR DISPLAY
	lcd_sendCmd(0xa0); //ADC NORMAL
	lcd_sendCmd(0xa6); //
	lcd_sendCmd(0xa4); //CLEAR
	lcd_sendCmd(0xa2); //1/6BIAS
	lcd_sendCmd(0xc8); //COMMON OUTPUT DIRECTION
	lcd_sendCmd(0x2f); //POWER CONTROL
	lcd_sendCmd(0x22); //RESISTER RATIO --粗调
	lcd_sendCmd(0x81); //VOLUM MODE SET
	lcd_sendCmd(0x20); //RESISTER RATIO --细调
	lcd_clearScreen();

	//lcd_display_8x16(2, 40, 1, &ip_tab[3][0]);
	//lcd_display_ip("192.168.15.201", 2, 8);
	//lcd_display_ip("192.168.0.0", 2, 8);
	//lcd_display_mainSlave("slave", 0, 0);
	//lcd_display_8x16(0, 0, 32, &string_tab[0][0]);
	//lcd_display_8x16(2, 0, 16, &string_tab[42][0]);
	//lcd_display_16x16_line(0, 0, 15, &tab[0][0]);
	
}


